<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Call Center</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        #chatbot-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            max-height: 500px;
            background-color: #f9f9f9;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #chatbot-header {
            background-color: #007BFF;
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }

        #chatbot-messages {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
        }

        .message {
            margin: 5px 0;
        }

        .message.user {
            text-align: right;
            color: #007BFF;
        }

        .message.bot {
            text-align: left;
            color: #333;
        }

        #chatbot-input-container {
            display: flex;
            border-top: 1px solid #ddd;
        }

        #chatbot-input {
            flex: 1;
            padding: 10px;
            border: none;
            outline: none;
        }

        #chatbot-send {
            background-color: #007BFF;
            color: white;
            padding: 10px;
            border: none;
            cursor: pointer;
        }

        #chatbot-send:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body>
    <div id="chatbot-container">
        <div id="chatbot-header">Call Center Chatbot</div>
        <div id="chatbot-messages"></div>
        <div id="chatbot-input-container">
            <input type="text" id="chatbot-input" placeholder="Type your message...">
            <button id="chatbot-send">Send</button>
        </div>
    </div>

    <script>
        const messagesContainer = document.getElementById("chatbot-messages");
        const inputField = document.getElementById("chatbot-input");
        const sendButton = document.getElementById("chatbot-send");

        const API_KEY = "VF.DM.6776fc9809e83f2e9815d3d0.mGpa0WsYBGLVBZoZ"; // Remplace par ta clé API Voiceflow
        const API_URL = "https://api.voiceflow.com"; // URL Voiceflow

        // Append a message to the chat
        function appendMessage(content, sender = "bot") {
            const messageDiv = document.createElement("div");
            messageDiv.classList.add("message", sender);
            messageDiv.textContent = content;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight; // Scroll to bottom
        }

        // Fetch response from Voiceflow API
        async function fetchChatbotResponse(userMessage) {
            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: API_KEY,
                    },
                    body: JSON.stringify({
                        request: {
                            type: "text",
                            payload: userMessage,
                        },
                    }),
                });
                const data = await response.json();
                const replies = data.payload.map((item) => item.text).join("\n");
                return replies || "Sorry, I couldn't understand that.";
            } catch (error) {
                console.error("Error fetching chatbot response:", error);
                return "Sorry, I couldn't fetch a response.";
            }
        }

        // Dynamic scenarios based on user input
        async function handleUserInput() {
            const userMessage = inputField.value.trim();
            if (userMessage) {
                appendMessage(userMessage, "user");
                inputField.value = "";

                // Custom scenarios for Call Center
                if (userMessage.toLowerCase().includes("horaire")) {
                    appendMessage("Nos horaires d’ouverture sont de 9h à 18h du lundi au vendredi.", "bot");
                } else if (userMessage.toLowerCase().includes("problème technique")) {
                    appendMessage("Pour des problèmes techniques, veuillez décrire votre problème ou contacter notre service technique au 01 23 45 67 89.", "bot");
                } else if (userMessage.toLowerCase().includes("agent")) {
                    appendMessage("Veuillez patienter pendant que nous connectons un agent.", "bot");
                } else {
                    // Fetch response from Voiceflow API for other queries
                    const botResponse = await fetchChatbotResponse(userMessage);
                    appendMessage(botResponse, "bot");
                }
            }
        }

        // Send message on button click
        sendButton.addEventListener("click", handleUserInput);

        // Send message on Enter key
        inputField.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                handleUserInput();
            }
        });

        // Welcome message
        appendMessage("Bonjour ! Comment puis-je vous aider aujourd'hui ?", "bot");
    </script>
</body>

</html>